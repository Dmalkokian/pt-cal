<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Calculator Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    function copyResultsToClipboard() {
        console.log('Results copy button clicked');
        
        if (!lastResults) {
            alert('No results to copy. Please calculate first.');
            return;
        }

        // Get current form values
        const refrigerant = document.getElementById('refrigerant').value;
        const suctionPressure = lastResults.pressure; // Using gauge pressure as suction pressure
        const liquidPressure = 'N/A'; // We don't have liquid pressure in current setup
        const superheat = Math.abs(lastResults.superheat).toFixed(1);
        const subcooling = Math.abs(lastResults.subcooling).toFixed(1);

        // Format as mini report
        const copyText = `=== HVAC READING REPORT ===
```

Date: ${new Date().toLocaleDateString()}
Time: ${new Date().toLocaleTimeString()}

SYSTEM INFORMATION:
Refrigerant Type: ${refrigerant}

PRESSURE READINGS:
Suction Pressure: ${suctionPressure} psig
Liquid Pressure: ${liquidPressure}

TEMPERATURE ANALYSIS:
Superheat: ${superheat}°${currentUnit}
Subcooling: ${subcooling}°${currentUnit}

=== END REPORT ===`;

```
        console.log('Text to copy:', copyText);

        // Show text in prompt for copying
        const userText = prompt('Copy this HVAC report:', copyText);
        if (userText !== null) {
            showResultsCopySuccess();
        }
    }

    function showResultsCopySuccess() {
        const copyBtn = document.getElementById('results-copy-btn');
        const originalText = copyBtn.textContent;
        
        copyBtn.textContent = '✅ Copied to Clipboard';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('copied');
        }, 2000);
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
    }

    .main-panel {
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    .memory-panel {
        background: white;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        height: fit-content;
    }

    h1 {
        color: #2d3748;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .subtitle {
        color: #718096;
        font-size: 1.1rem;
        margin-bottom: 30px;
    }

    .form-section {
        margin-bottom: 25px;
    }

    .form-section h3 {
        color: #4a5568;
        font-size: 1.2rem;
        margin-bottom: 15px;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: #4a5568;
        font-weight: 500;
    }

    select, input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.2s;
        background: white;
    }

    select:focus, input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .unit-toggle {
        display: flex;
        background: #f7fafc;
        border-radius: 8px;
        padding: 4px;
        border: 2px solid #e2e8f0;
    }

    .unit-toggle button {
        flex: 1;
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        background: transparent;
        color: #718096;
        cursor: pointer;
        transition: all 0.2s;
    }

    .unit-toggle button.active {
        background: #667eea;
        color: white;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .mode-selector {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    .mode-btn {
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
        color: #4a5568;
    }

    .mode-btn.active {
        border-color: #667eea;
        background: #f0f4ff;
        color: #667eea;
    }

    .saturation-display {
        margin-top: 8px;
        padding: 8px 12px;
        background: #e6f3ff;
        border-radius: 6px;
        font-size: 14px;
        color: #2b6cb0;
        font-weight: 500;
    }

    .sh-sc-toggle {
        display: flex;
        background: #f7fafc;
        border-radius: 8px;
        padding: 4px;
        border: 2px solid #e2e8f0;
        position: relative;
        user-select: none;
        cursor: pointer;
    }

    .sh-sc-toggle::after {
        display: none;
    }

    .dark-mode-toggle .icon {
        width: 18px;
        height: 18px;
        fill: currentColor;
        transition: transform 0.3s ease;
    }

    .sh-sc-toggle {
        display: flex;
        background: #f7fafc;
        border-radius: 8px;
        padding: 4px;
        border: 2px solid #e2e8f0;
        position: relative;
        user-select: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .sh-sc-toggle button {
        flex: 1;
        padding: 12px 16px;
        border: none;
        border-radius: 6px;
        background: transparent;
        cursor: pointer;
        transition: all 0.2s;
        color: #718096;
    }

    .sh-sc-toggle button.active {
        background: #667eea;
        color: white;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .calculate-btn {
        width: 100%;
        padding: 16px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .results-section {
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        border-radius: 12px;
        padding: 25px;
        margin-top: 30px;
    }

    .results-header h3 {
        color: #4a5568;
        margin-bottom: 20px;
    }

    .result-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .result-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .result-card.pressure {
        border-left-color: #e53e3e;
    }

    .result-card.temperature {
        border-left-color: #3182ce;
    }

    .result-card.superheat {
        border-left-color: #38a169;
    }

    .result-card.superheat.out-of-range {
        border-left-color: #e53e3e;
        background: #fff5f5;
    }

    .result-card.superheat.in-range {
        background: #f0fff4;
    }

    .result-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #718096;
        margin-bottom: 5px;
    }

    .result-value {
        font-size: 24px;
        font-weight: 700;
        color: #2d3748;
    }

    .target-range {
        margin-top: 8px;
        font-size: 12px;
        color: #718096;
    }

    .memory-section h3 {
        color: #4a5568;
        margin-bottom: 15px;
    }

    .memory-item {
        background: #f7fafc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 3px solid #667eea;
    }

    .memory-item-header {
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 5px;
    }

    .memory-item-data {
        font-size: 12px;
        color: #718096;
        line-height: 1.4;
    }

    .clear-memory {
        background: #fed7d7;
        color: #c53030;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        margin-top: 10px;
        width: 100%;
    }

    @media (max-width: 768px) {
        body {
            padding: 5px;
        }

        .container {
            grid-template-columns: 1fr;
            gap: 10px;
            max-width: 100%;
            margin: 0 auto;
        }

        .main-panel {
            padding: 15px;
            margin: 0 auto;
            width: 100%;
            max-width: 500px;
        }

        .memory-panel {
            padding: 10px;
            margin: 0 auto;
            width: 100%;
            max-width: 500px;
        }

        .form-section {
            margin-bottom: 15px;
        }

        .form-row {
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-group {
            max-width: 100%;
            margin: 0 auto 10px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .form-group input,
        .form-group select {
            max-width: 350px;
            width: 100%;
        }

        .unit-toggle, 
        .sh-sc-toggle {
            max-width: 300px;
            width: 300px;
            margin: 0 auto;
        }

        .mode-selector {
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 10px;
            max-width: 350px;
            margin: 0 auto 10px auto;
        }

        .mode-btn {
            padding: 8px 4px;
            font-size: 12px;
        }

        .result-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .result-card {
            padding: 12px;
        }

        .result-value {
            font-size: 18px;
        }

        h1 {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 5px;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .form-section h3 {
            text-align: center;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .results-header h3 {
            text-align: center;
            margin-bottom: 10px;
        }

        .memory-section h3 {
            text-align: center;
            margin-bottom: 10px;
        }

        .results-section {
            margin-top: 15px;
            padding: 15px;
        }

        .calculate-btn {
            margin: 10px auto;
            max-width: 300px;
            width: 300px;
            padding: 12px 20px;
            font-size: 16px;
            display: block;
        }

        select, input {
            font-size: 16px;
            padding: 10px 12px;
        }

        .saturation-display {
            margin-top: 5px;
            padding: 6px 10px;
            font-size: 12px;
            max-width: 350px;
            width: 100%;
        }

        .memory-item {
            padding: 10px;
            margin-bottom: 8px;
        }

        .memory-item-header {
            font-size: 12px;
        }

        .memory-item-data {
            font-size: 11px;
        }

        label {
            margin-bottom: 5px;
            font-size: 14px;
            text-align: center;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <!-- Dark Mode Toggle -->
        <div class="dark-mode-toggle">
            <span id="mode-label">Light</span>
            <div class="toggle-switch" id="toggle-switch">
                <div class="toggle-slider">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 17.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 13H1v-2h5v2zm17-2h-5v2h5v-2zM12 4.5c.28 0 .5-.22.5-.5V1h-1v3c0 .28.22.5.5.5zm0 15c-.28 0-.5.22-.5.5v3h1v-3c0-.28-.22-.5-.5-.5zM6.5 7.91L4.08 5.49 2.66 6.91l2.42 2.42L6.5 7.91zm12.42 2.42l2.42-2.42-1.42-1.42-2.42 2.42L17.5 10.33zm0 3.84l-1.42 1.42 2.42 2.42 1.42-1.42-2.42-2.42zM6.5 16.09l1.42 1.42L5.5 19.93 4.08 18.51l2.42-2.42z"/>
                    </svg>
                </div>
            </div>
        </div>

```
    <div class="main-panel">
        <h1>🔧 HVAC Calculator Pro</h1>
        <p class="subtitle">Professional refrigerant superheat & subcooling calculator</p>

        <div class="form-section">
            <h3>⚙️ Refrigerant & Settings</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="refrigerant">Refrigerant Type</label>
                    <select id="refrigerant">
                        <option value="R-410A">R-410A</option>
                        <option value="R-404A">R-404A</option>
                        <option value="R-290">R-290</option>
                        <option value="R-22">R-22</option>
                        <option value="R-32">R-32</option>
                        <option value="R-448A">R-448A</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Temperature Unit</label>
                    <div class="unit-toggle">
                        <button type="button" id="fahrenheit-btn" class="active" title="Alt+U to toggle units">°F</button>
                        <button type="button" id="celsius-btn" title="Alt+U to toggle units">°C</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>System Mode (Optional)</label>
                <div class="mode-selector">
                    <div class="mode-btn active" data-mode="ac" title="Press 1">
                        AC Mode<br><small>12-10°F SH</small>
                    </div>
                    <div class="mode-btn" data-mode="refrigeration" title="Press 2">
                        Refrigeration<br><small>10-8°F SH</small>
                    </div>
                    <div class="mode-btn" data-mode="freezer" title="Press 3">
                        Freezer<br><small>8-6°F SH</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>📊 Measurements</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="gauge-pressure">Gauge Pressure (psig)</label>
                    <input type="number" id="gauge-pressure" placeholder="Enter pressure" step="0.1" title="Use ↑↓ arrows to adjust">
                    <div id="saturation-temp" class="saturation-display">Saturation Temperature: --</div>
                </div>
                
                <div class="form-group">
                    <label for="pipe-temp">Pipe Temperature</label>
                    <input type="number" id="pipe-temp" placeholder="Enter temperature" step="0.1" title="Use ↑↓ arrows to adjust">
                </div>
            </div>

            <div class="form-group">
                <label>Calculation Type</label>
                <div class="sh-sc-toggle">
                    <button type="button" id="superheat-btn" class="active" title="Alt+S to toggle">Superheat</button>
                    <button type="button" id="subcooling-btn" title="Alt+S to toggle">Subcooling</button>
                </div>
            </div>

            <div class="form-group">
                <button type="button" id="calculate-btn" class="calculate-btn" title="Enter key to calculate">
                    ➕ Calculate
                </button>
            </div>

            <div class="form-group" id="copy-section" style="display: none;">
                <button type="button" id="copy-btn" class="copy-btn">
                    📋 Copy Results
                </button>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">
                <h3>📈 Results</h3>
            </div>

            <div class="result-grid" id="results-grid">
                <div style="grid-column: 1 / -1; text-align: center; color: #718096; padding: 40px;">
                    Enter pressure and temperature values, then click Calculate
                </div>
            </div>
        </div>
    </div>

    <div class="memory-panel">
        <div class="memory-section">
            <h3>⭐ Memory</h3>
            <div id="memory-list">
                <p style="color: #718096; text-align: center; padding: 20px;">No calculations stored yet</p>
            </div>
            <button class="clear-memory" id="clear-memory" title="Alt+M to clear memory">Clear All</button>
        </div>
    </div>
</div>

<script>
    console.log('HVAC Calculator V7 loading...');

    const refrigerantData = {
        'R-410A': [
            [0, -55], [10, -45], [20, -35], [30, -26], [40, -18], [50, -10],
            [60, -2], [70, 5], [80, 12], [90, 19], [100, 26], [110, 32], [120, 38],
            [130, 44], [140, 50], [150, 56], [160, 61], [170, 67], [180, 72],
            [190, 77], [200, 82], [220, 91], [240, 100], [260, 108], [280, 116],
            [300, 124], [320, 131], [340, 138], [360, 145], [380, 152], [400, 158]
        ],
        'R-404A': [
            [0, -60], [10, -50], [20, -41], [30, -33], [40, -25], [50, -18],
            [60, -11], [70, -4], [80, 2], [90, 8], [100, 14], [110, 20], [120, 26],
            [130, 31], [140, 37], [150, 42], [160, 47], [170, 52], [180, 57],
            [190, 62], [200, 66], [220, 75], [240, 83], [260, 91], [280, 99],
            [300, 106], [320, 113], [340, 119], [360, 126], [380, 132], [400, 138]
        ],
        'R-290': [
            [0, -44], [10, -35], [20, -27], [30, -19], [40, -12], [50, -5],
            [60, 2], [70, 8], [80, 14], [90, 20], [100, 26], [110, 31], [120, 37],
            [130, 42], [140, 47], [150, 52], [160, 57], [170, 62], [180, 66],
            [190, 71], [200, 75], [220, 83], [240, 91], [260, 98], [280, 105],
            [300, 112], [320, 118], [340, 125], [360, 131], [380, 137], [400, 143]
        ],
        'R-22': [
            [0, -41], [10, -32], [20, -24], [30, -16], [40, -9], [50, -2],
            [60, 5], [70, 11], [80, 17], [90, 23], [100, 29], [110, 34], [120, 40],
            [130, 45], [140, 50], [150, 55], [160, 60], [170, 65], [180, 69],
            [190, 74], [200, 78], [220, 86], [240, 94], [260, 101], [280, 108],
            [300, 115], [320, 121], [340, 127], [360, 133], [380, 139], [400, 145]
        ],
        'R-32': [
            [0, -52], [10, -42], [20, -33], [30, -25], [40, -17], [50, -10],
            [60, -3], [70, 3], [80, 9], [90, 15], [100, 21], [110, 27], [120, 32],
            [130, 38], [140, 43], [150, 48], [160, 53], [170, 58], [180, 63],
            [190, 67], [200, 72], [220, 80], [240, 88], [260, 95], [280, 102],
            [300, 109], [320, 115], [340, 121], [360, 127], [380, 133], [400, 139]
        ],
        'R-448A': [
            [0, -58], [10, -48], [20, -39], [30, -31], [40, -23], [50, -16],
            [60, -9], [70, -2], [80, 4], [90, 10], [100, 16], [110, 22], [120, 28],
            [130, 33], [140, 39], [150, 44], [160, 49], [170, 54], [180, 59],
            [190, 64], [200, 68], [220, 77], [240, 85], [260, 93], [280, 100],
            [300, 107], [320, 114], [340, 120], [360, 126], [380, 132], [400, 138]
        ]
    };

    const targetRanges = {
        ac: { min: 10, max: 12 },
        refrigeration: { min: 8, max: 10 },
        freezer: { min: 6, max: 8 }
    };

    let currentUnit = 'F';
    let currentMode = 'ac';
    let showSuperheat = true;

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, setting up V7...');
        setupEventListeners();
        setupKeyboardNavigation();
        setupDarkMode();
        loadMemory();
    });

    function setupEventListeners() {
        document.getElementById('fahrenheit-btn').addEventListener('click', () => {
            hapticFeedback();
            setUnit('F');
        });
        document.getElementById('celsius-btn').addEventListener('click', () => {
            hapticFeedback();
            setUnit('C');
        });

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                hapticFeedback();
                setMode(btn.dataset.mode);
            });
        });

        document.getElementById('superheat-btn').addEventListener('click', () => {
            hapticFeedback();
            toggleView(true);
        });
        document.getElementById('subcooling-btn').addEventListener('click', () => {
            hapticFeedback();
            toggleView(false);
        });

        document.getElementById('calculate-btn').addEventListener('click', () => {
            hapticFeedback('medium');
            calculate();
        });
        document.getElementById('copy-btn').addEventListener('click', () => {
            hapticFeedback('light');
            copyResults();
        });
        document.getElementById('clear-memory').addEventListener('click', () => {
            hapticFeedback();
            clearMemory();
        });

        // Setup swipe gestures for SH/SC toggle
        setupSwipeGestures();
    }

    function setupDarkMode() {
        const toggleSwitch = document.getElementById('toggle-switch');
        const modeLabel = document.getElementById('mode-label');
        const body = document.body;
        
        console.log('Setting up dark mode...');
        
        // Check for saved preference or default to light mode
        const savedMode = localStorage.getItem('darkMode');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        console.log('Saved mode:', savedMode, 'Prefers dark:', prefersDark);
        
        if (savedMode === 'dark' || (!savedMode && prefersDark)) {
            enableDarkMode();
        } else {
            disableDarkMode();
        }
        
        // Toggle dark mode
        toggleSwitch.addEventListener('click', () => {
            console.log('Dark mode toggle clicked');
            hapticFeedback('light');
            if (body.classList.contains('dark-mode')) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        });
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('darkMode')) {
                if (e.matches) {
                    enableDarkMode();
                } else {
                    disableDarkMode();
                }
            }
        });
    }

    function enableDarkMode() {
        console.log('Enabling dark mode');
        document.body.classList.add('dark-mode');
        document.getElementById('toggle-switch').classList.add('active');
        document.getElementById('mode-label').textContent = 'Dark';
        localStorage.setItem('darkMode', 'dark');
        
        // Update icon to moon
        const icon = document.querySelector('.toggle-slider .icon');
        if (icon) {
            icon.innerHTML = '<path d="M12 2.5c5.25 0 9.5 4.25 9.5 9.5s-4.25 9.5-9.5 9.5c-1.85 0-3.55-.53-5-1.44 2.36-1.34 3.95-3.87 3.95-6.81 0-2.94-1.59-5.47-3.95-6.81C8.45 3.03 10.15 2.5 12 2.5z"/>';
        }
    }

    function disableDarkMode() {
        console.log('Disabling dark mode');
        document.body.classList.remove('dark-mode');
        document.getElementById('toggle-switch').classList.remove('active');
        document.getElementById('mode-label').textContent = 'Light';
        localStorage.setItem('darkMode', 'light');
        
        // Update icon to sun
        const icon = document.querySelector('.toggle-slider .icon');
        if (icon) {
            icon.innerHTML = '<path d="M12 17.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 13H1v-2h5v2zm17-2h-5v2h5v-2zM12 4.5c.28 0 .5-.22.5-.5V1h-1v3c0 .28.22.5.5.5zm0 15c-.28 0-.5.22-.5.5v3h1v-3c0-.28-.22-.5-.5-.5zM6.5 7.91L4.08 5.49 2.66 6.91l2.42 2.42L6.5 7.91zm12.42 2.42l2.42-2.42-1.42-1.42-2.42 2.42L17.5 10.33zm0 3.84l-1.42 1.42 2.42 2.42 1.42-1.42-2.42-2.42zM6.5 16.09l1.42 1.42L5.5 19.93 4.08 18.51l2.42-2.42z"/>';
        }
    }

    function hapticFeedback(intensity = 'light') {
        // Check if device supports haptic feedback
        if ('vibrate' in navigator) {
            switch(intensity) {
                case 'light':
                    navigator.vibrate(10);
                    break;
                case 'medium':
                    navigator.vibrate(25);
                    break;
                case 'heavy':
                    navigator.vibrate(50);
                    break;
                default:
                    navigator.vibrate(10);
            }
        }
        
        // iOS haptic feedback (if available)
        if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
            // iOS 13+ haptic feedback
            try {
                if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
                    // Use iOS-specific haptic feedback if available
                    if (window.AudioContext || window.webkitAudioContext) {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                    }
                }
            } catch (error) {
                // Fallback to vibration
                console.log('Haptic feedback not available');
            }
        }
    }

    function setupSwipeGestures() {
        // Setup swipe for SH/SC toggle
        setupToggleSwipe('.sh-sc-toggle', () => {
            if (showSuperheat) {
                toggleView(false);
            } else {
                toggleView(true);
            }
        });

        // Setup swipe for F/C toggle
        setupToggleSwipe('.unit-toggle', () => {
            const newUnit = currentUnit === 'F' ? 'C' : 'F';
            setUnit(newUnit);
        });
    }

    function setupToggleSwipe(selector, onSwipe) {
        const toggle = document.querySelector(selector);
        let startX = 0;
        let startY = 0;
        let endX = 0;
        let endY = 0;
        
        // Touch events
        toggle.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, { passive: true });
        
        toggle.addEventListener('touchend', function(e) {
            endX = e.changedTouches[0].clientX;
            endY = e.changedTouches[0].clientY;
            handleSwipe();
        }, { passive: true });
        
        // Mouse events for desktop
        let isMouseDown = false;
        
        toggle.addEventListener('mousedown', function(e) {
            isMouseDown = true;
            startX = e.clientX;
            startY = e.clientY;
        });
        
        toggle.addEventListener('mouseup', function(e) {
            if (isMouseDown) {
                endX = e.clientX;
                endY = e.clientY;
                handleSwipe();
                isMouseDown = false;
            }
        });
        
        function handleSwipe() {
            const deltaX = endX - startX;
            const deltaY = endY - startY;
            const minSwipeDistance = 30;
            
            // Only process horizontal swipes
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                hapticFeedback('light');
                onSwipe();
            }
        }
    }

    function showSwipeHint(message) {
        // Create temporary swipe hint
        const hint = document.createElement('div');
        hint.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(70, 130, 234, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            pointer-events: none;
            animation: swipeHintAnim 1.5s ease-out;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        `;
        hint.textContent = message;
        
        // Add swipe hint animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes swipeHintAnim {
                0% { 
                    opacity: 0; 
                    transform: translate(-50%, -50%) scale(0.8);
                }
                20% { 
                    opacity: 1; 
                    transform: translate(-50%, -50%) scale(1.1);
                }
                30% {
                    transform: translate(-50%, -50%) scale(1);
                }
                80% { 
                    opacity: 1; 
                    transform: translate(-50%, -50%) scale(1);
                }
                100% { 
                    opacity: 0; 
                    transform: translate(-50%, -50%) scale(0.9);
                }
            }
        `;
        document.head.appendChild(style);
        document.body.appendChild(hint);
        
        // Remove after animation
        setTimeout(() => {
            if (hint.parentNode) hint.parentNode.removeChild(hint);
            if (style.parentNode) style.parentNode.removeChild(style);
        }, 1500);
    }

    function setupKeyboardNavigation() {
        // Global keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Enter key - Calculate (from anywhere)
            if (e.key === 'Enter' && !e.ctrlKey && !e.altKey) {
                e.preventDefault();
                calculate();
                return;
            }

            // Ctrl+Enter - Focus on calculate button
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                document.getElementById('calculate-btn').focus();
                return;
            }

            // Escape - Clear current input or focus
            if (e.key === 'Escape') {
                const activeElement = document.activeElement;
                if (activeElement.tagName === 'INPUT') {
                    activeElement.value = '';
                    activeElement.blur();
                } else {
                    document.activeElement.blur();
                }
                return;
            }

            // Alt+U - Toggle temperature units
            if (e.key.toLowerCase() === 'u' && e.altKey) {
                e.preventDefault();
                toggleUnit();
                return;
            }

            // Alt+S - Toggle Superheat/Subcooling
            if (e.key.toLowerCase() === 's' && e.altKey) {
                e.preventDefault();
                toggleView(!showSuperheat);
                return;
            }

            // Alt+C - Clear all inputs
            if (e.key.toLowerCase() === 'c' && e.altKey) {
                e.preventDefault();
                clearAllInputs();
                return;
            }

            // Alt+M - Clear memory
            if (e.key.toLowerCase() === 'm' && e.altKey) {
                e.preventDefault();
                if (confirm('Clear all memory? This cannot be undone.')) {
                    clearMemory();
                }
                return;
            }

            // Number keys 1-3 for mode selection (when not in input)
            if (['1', '2', '3'].includes(e.key) && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                const modes = ['ac', 'refrigeration', 'freezer'];
                setMode(modes[parseInt(e.key) - 1]);
                return;
            }

            // Arrow keys for value adjustment in number inputs
            if (document.activeElement.type === 'number') {
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    adjustInputValue(document.activeElement, 1);
                    return;
                }
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    adjustInputValue(document.activeElement, -1);
                    return;
                }
            }
        });

        // Tab navigation enhancement
        const focusableElements = [
            '#refrigerant',
            '#fahrenheit-btn',
            '#celsius-btn',
            '.mode-btn.active',
            '#gauge-pressure',
            '#pipe-temp',
            '#superheat-btn',
            '#subcooling-btn',
            '#calculate-btn'
        ];

        // Auto-focus first input on load
        setTimeout(() => {
            document.getElementById('gauge-pressure').focus();
        }, 100);
    }

    function toggleUnit() {
        const newUnit = currentUnit === 'F' ? 'C' : 'F';
        setUnit(newUnit);
        showKeyboardHint(`Switched to °${newUnit}`);
    }

    function clearAllInputs() {
        document.getElementById('gauge-pressure').value = '';
        document.getElementById('pipe-temp').value = '';
        document.getElementById('saturation-temp').textContent = 'Saturation Temperature: --';
        
        // Clear results
        document.getElementById('results-grid').innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; color: #718096; padding: 40px;">
                Enter pressure and temperature values, then click Calculate
            </div>
        `;
        
        // Focus back to first input
        document.getElementById('gauge-pressure').focus();
        showKeyboardHint('All inputs cleared');
    }

    function adjustInputValue(input, delta) {
        const currentValue = parseFloat(input.value) || 0;
        const step = parseFloat(input.step) || 1;
        const newValue = currentValue + (delta * step);
        
        // Respect min/max if set
        const min = input.min ? parseFloat(input.min) : -Infinity;
        const max = input.max ? parseFloat(input.max) : Infinity;
        
        input.value = Math.max(min, Math.min(max, newValue));
        
        // Trigger input event for any listeners
        input.dispatchEvent(new Event('input', { bubbles: true }));
    }

    function showKeyboardHint(message) {
        // Create temporary hint overlay
        const hint = document.createElement('div');
        hint.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4a5568;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 1000;
            animation: fadeInOut 2s ease-in-out;
        `;
        hint.textContent = message;
        
        // Add fadeInOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateY(-10px); }
                20% { opacity: 1; transform: translateY(0); }
                80% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-10px); }
            }
        `;
        document.head.appendChild(style);
        document.body.appendChild(hint);
        
        // Remove after animation
        setTimeout(() => {
            if (hint.parentNode) {
                hint.parentNode.removeChild(hint);
            }
            if (style.parentNode) {
                style.parentNode.removeChild(style);
            }
        }, 2000);
    }

    function setUnit(unit) {
        currentUnit = unit;
        document.getElementById('fahrenheit-btn').classList.toggle('active', unit === 'F');
        document.getElementById('celsius-btn').classList.toggle('active', unit === 'C');
    }

    function setMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.mode === mode);
        });
    }

    function toggleView(superheat) {
        showSuperheat = superheat;
        document.getElementById('superheat-btn').classList.toggle('active', superheat);
        document.getElementById('subcooling-btn').classList.toggle('active', !superheat);
    }

    function interpolate(pressure, data) {
        if (pressure <= data[0][0]) return data[0][1];
        if (pressure >= data[data.length - 1][0]) return data[data.length - 1][1];

        for (let i = 0; i < data.length - 1; i++) {
            if (pressure >= data[i][0] && pressure <= data[i + 1][0]) {
                const ratio = (pressure - data[i][0]) / (data[i + 1][0] - data[i][0]);
                return data[i][1] + ratio * (data[i + 1][1] - data[i][1]);
            }
        }
        return null;
    }

    function convertTemp(temp, fromUnit, toUnit) {
        if (fromUnit === toUnit) return temp;
        if (fromUnit === 'F' && toUnit === 'C') return (temp - 32) * 5/9;
        if (fromUnit === 'C' && toUnit === 'F') return temp * 9/5 + 32;
        return temp;
    }

    function calculate() {
        console.log('Calculate button clicked in V7');
        
        const refrigerant = document.getElementById('refrigerant').value;
        const pressure = parseFloat(document.getElementById('gauge-pressure').value);
        const pipeTemp = parseFloat(document.getElementById('pipe-temp').value);

        if (!refrigerant || isNaN(pressure) || isNaN(pipeTemp)) {
            alert('Please enter valid pressure and temperature values');
            return;
        }

        const data = refrigerantData[refrigerant];
        const satTempF = interpolate(pressure, data);
        
        if (satTempF === null) {
            alert('Pressure value is outside the available range');
            return;
        }

        const satTemp = currentUnit === 'F' ? satTempF : convertTemp(satTempF, 'F', 'C');
        const actualPipeTemp = currentUnit === 'F' ? pipeTemp : convertTemp(pipeTemp, 'C', 'F');
        
        // CORRECTED FORMULAS:
        // Superheat = Actual Temperature - Saturated Temperature (for vapor/suction line)
        // Subcooling = Saturated Temperature - Actual Temperature (for liquid line)
        const superheat = actualPipeTemp - satTempF;  // This is correct for suction line
        const subcooling = satTempF - actualPipeTemp; // This is correct for liquid line

        document.getElementById('saturation-temp').textContent = 
            `Saturation Temperature: ${satTemp.toFixed(1)}°${currentUnit}`;

        displayResults({
            refrigerant,
            pressure,
            pipeTemp,
            satTemp,
            superheat: currentUnit === 'F' ? superheat : convertTemp(superheat, 'F', 'C'),
            subcooling: currentUnit === 'F' ? subcooling : convertTemp(subcooling, 'F', 'C')
        });

        // Save to memory - only save data for the current mode
        const currentCalculation = showSuperheat ? superheat : subcooling;
        const currentCalculationType = showSuperheat ? 'superheat' : 'subcooling';
        
        saveToMemory({
            refrigerant,
            pressure,
            pipeTemp,
            satTemp,
            calculationType: currentCalculationType,
            result: currentCalculation,
            superheat: showSuperheat ? superheat : null,
            subcooling: !showSuperheat ? subcooling : null,
            unit: currentUnit,
            timestamp: new Date().toLocaleString()
        });
    }

    let lastResults = null;

    function copyResults() {
        console.log('Copy button clicked');
        
        if (!lastResults) {
            alert('No results to copy. Please calculate first.');
            return;
        }

        const value = showSuperheat ? lastResults.superheat : lastResults.subcooling;
        const label = showSuperheat ? 'Superheat' : 'Subcooling';
        
        // Simple text format
        const copyText = `HVAC Reading
```

${label}: ${Math.abs(value).toFixed(1)}°${currentUnit}
Pressure: ${lastResults.pressure} psig
Pipe Temp: ${lastResults.pipeTemp}°${currentUnit}
Refrigerant: ${lastResults.refrigerant}`;

```
        console.log('Text to copy:', copyText);

        // Always show the text in a prompt for manual copying
        const userText = prompt('Copy this text:', copyText);
        if (userText !== null) {
            showCopySuccess();
        }
    }

    function showCopySuccess() {
        const copyBtn = document.getElementById('copy-btn');
        const originalText = copyBtn.textContent;
        
        copyBtn.textContent = '✅ Copied!';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('copied');
        }, 2000);
    }

    function displayResults(results) {
        const grid = document.getElementById('results-grid');
        const value = showSuperheat ? results.superheat : results.subcooling;
        const label = showSuperheat ? 'Superheat' : 'Subcooling';
        
        let inRange = false;
        let rangeClass = '';
        
        if (showSuperheat) {
            const range = targetRanges[currentMode];
            const superheatF = currentUnit === 'F' ? results.superheat : convertTemp(results.superheat, 'C', 'F');
            inRange = superheatF >= range.min && superheatF <= range.max;
            rangeClass = inRange ? 'in-range' : 'out-of-range';
        }

        grid.innerHTML = `
            <div class="result-card">
                <div class="result-label">Refrigerant</div>
                <div class="result-value">${results.refrigerant}</div>
            </div>
            
            <div class="result-card pressure">
                <div class="result-label">Pressure</div>
                <div class="result-value">${results.pressure} psig</div>
            </div>
            
            <div class="result-card temperature">
                <div class="result-label">Saturation Temp</div>
                <div class="result-value">${results.satTemp.toFixed(1)}°${currentUnit}</div>
            </div>
            
            <div class="result-card temperature">
                <div class="result-label">Pipe Temp</div>
                <div class="result-value">${results.pipeTemp}°${currentUnit}</div>
            </div>
            
            <div class="result-card superheat ${rangeClass}">
                <div class="result-label">${label}</div>
                <div class="result-value">${Math.abs(value).toFixed(1)}°${currentUnit}</div>
                ${showSuperheat ? `<div class="target-range">Target: ${targetRanges[currentMode].min}-${targetRanges[currentMode].max}°F</div>` : ''}
            </div>
        `;
    }

    function saveToMemory(data) {
        console.log('Saving to memory:', data);
        let memory = JSON.parse(localStorage.getItem('hvacMemory') || '[]');
        memory.unshift(data);
        memory = memory.slice(0, 5); // Keep only last 5
        localStorage.setItem('hvacMemory', JSON.stringify(memory));
        console.log('Memory saved, current memory:', memory);
        displayMemory();
    }

    function loadMemory() {
        displayMemory();
    }

    function displayMemory() {
        const memory = JSON.parse(localStorage.getItem('hvacMemory') || '[]');
        const memoryList = document.getElementById('memory-list');
        
        if (memory.length === 0) {
            memoryList.innerHTML = '<p style="color: #718096; text-align: center; padding: 20px;">No calculations stored yet</p>';
            return;
        }

        memoryList.innerHTML = memory.map((item, index) => {
            // Handle both old format (with both SH/SC) and new format (single calculation)
            let calculationDisplay = '';
            if (item.calculationType) {
                // New format - single calculation
                if (item.calculationType === 'superheat') {
                    calculationDisplay = `SH: ${item.result.toFixed(1)}°${item.unit}`;
                } else {
                    calculationDisplay = `SC: ${item.result.toFixed(1)}°${item.unit}`;
                }
            } else {
                // Old format - show both (for backward compatibility)
                calculationDisplay = `SH: ${item.superheat.toFixed(1)}°${item.unit} | SC: ${item.subcooling.toFixed(1)}°${item.unit}`;
            }

            return `
                <div class="memory-item">
                    <div class="memory-item-content">
                        <div class="memory-item-info">
                            <div class="memory-item-header">${item.refrigerant} - ${item.timestamp}</div>
                            <div class="memory-item-data">
                                Pressure: ${item.pressure} psig | Pipe: ${item.pipeTemp}°${item.unit}<br>
                                ${calculationDisplay}
                            </div>
                        </div>
                        <button class="memory-copy-btn" onclick="copyMemoryItem(${index})">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18 16V6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2v-2h2c1.1 0 2-.9 2-2zm-6 4H4V10h2v6c0 1.1.9 2 2 2h4v2zm4-4H8V6h8v10z"/>
                            </svg>
                            Share
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function copyMemoryItem(index) {
        console.log('Copy memory item clicked, index:', index);
        
        const memory = JSON.parse(localStorage.getItem('hvacMemory') || '[]');
        console.log('Memory array:', memory);
        
        const item = memory[index];
        console.log('Item to copy:', item);
        
        if (!item) {
            alert('Memory item not found.');
            return;
        }

        hapticFeedback('light');

        // Format text based on calculation type
        let copyText = '';
        if (item.calculationType) {
            // New format - single calculation
            const calculationType = item.calculationType === 'superheat' ? 'Superheat' : 'Subcooling';
            const result = item.result.toFixed(1);
            
            copyText = `HVAC Reading - ${item.timestamp}
```

Refrigerant: ${item.refrigerant}
Pressure: ${item.pressure} psig
Pipe Temp: ${item.pipeTemp}°${item.unit}
${calculationType}: ${result}°${item.unit}`; } else { // Old format - both calculations (backward compatibility) copyText = `HVAC Reading - ${item.timestamp}
Refrigerant: ${item.refrigerant}
Pressure: ${item.pressure} psig
Pipe Temp: ${item.pipeTemp}°${item.unit}
Superheat: ${item.superheat.toFixed(1)}°${item.unit}
Subcooling: ${item.subcooling.toFixed(1)}°${item.unit}`;
}

```
        console.log('Text to copy:', copyText);

        // Try to copy using different methods
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(copyText).then(() => {
                console.log('Clipboard copy successful');
                showMemoryCopySuccess(index);
            }).catch((err) => {
                console.error('Clipboard copy failed:', err);
                // Fallback to prompt
                const userText = prompt('Copy this reading:', copyText);
                if (userText !== null) {
                    showMemoryCopySuccess(index);
                }
            });
        } else {
            // Use prompt as fallback
            console.log('Using prompt fallback');
            const userText = prompt('Copy this reading:', copyText);
            if (userText !== null) {
                showMemoryCopySuccess(index);
            }
        }
    }

    function showMemoryCopySuccess(index) {
        const copyBtns = document.querySelectorAll('.memory-copy-btn');
        const btn = copyBtns[index];
        
        if (btn) {
            const originalText = btn.textContent;
            btn.innerHTML = `
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                </svg>
                Shared
            `;
            btn.classList.add('copied');
            
            setTimeout(() => {
                btn.innerHTML = `
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18 16V6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2v-2h2c1.1 0 2-.9 2-2zm-6 4H4V10h2v6c0 1.1.9 2 2 2h4v2zm4-4H8V6h8v10z"/>
                </svg>
                Share
            `;
                btn.classList.remove('copied');
            }, 2000);
        }
    }

    function clearMemory() {
        localStorage.removeItem('hvacMemory');
        displayMemory();
    }

    console.log('HVAC Calculator V7 ready!');
</script>
```

</body>
</html>